<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TalkJS Demo: Two Users</title>
<style>
body { font-family: Arial; background:#f4f6f8; margin:0; }
.container { max-width:500px; margin:20px auto; padding:20px; background:white; border-radius:8px; }
button { padding:10px 15px; margin:5px; cursor:pointer; }
#talkjs { height:500px; margin-top:15px; }
</style>
</head>
<body>

<div class="container">
  <h2>TalkJS Two-Person Demo</h2>
  <p>Click below to switch between Buyer and Seller:</p>
  <button onclick="setUser('buyer')">Login as Buyer</button>
  <button onclick="setUser('seller')">Login as Seller</button>
</div>

<div class="container" id="chatContainer" style="display:none;">
  <h3>Marketplace Chat</h3>
  <div id="talkjs"></div>
</div>

<!-- TalkJS -->
<script>
(function(t,a,l,k,j,s){
  s=a.createElement('script');s.async=1;s.src='https://cdn.talkjs.com/talk.js';
  a.head.appendChild(s);k=t.Promise;
  t.Talk={v:3,ready:{then:function(f){if(k)return new k(function(r,e){l.push([f,r,e])});l.push([f])},catch:function(){return k&&new k()},c:l}};
})(window,document,[]);
</script>

<script>
let currentUser = null;

// Define both users
const users = {
  buyer: { id: "buyer_1", name: "Buyer" },
  seller: { id: "seller_1", name: "Seller" }
};

// Function to switch users
function setUser(userKey) {
  currentUser = users[userKey];
  document.getElementById('chatContainer').style.display = 'block';
  startChat();
}

// Start chat session
function startChat() {
  Talk.ready.then(() => {
    const me = new Talk.User({
      id: currentUser.id,
      name: currentUser.name
    });

    const other = (currentUser.id === "buyer_1") ? 
                  new Talk.User(users.seller) : 
                  new Talk.User(users.buyer);

    const session = new Talk.Session({
      appId: "tbR8alHz", // Your TalkJS App ID
      me: me
    });

    // Create or get conversation
    const conversation = session.getOrCreateConversation("demo_conversation");
    conversation.setParticipant(me);
    conversation.setParticipant(other);

    // Mount inbox
    const inbox = session.createInbox({ selected: conversation });
    inbox.mount(document.getElementById("talkjs"));
  });
}
</script>

</body>
</html>
